---
title: "Week 2 Exercises"
author: "Michael Durning"
date: "March 24, 2023"
output: pdf_document
---

Please complete all exercises below. You may use stringr, lubridate, or the forcats library. 

Place this at the top of your script:
library(stringr)
library(lubridate)
library(forcats)

# Exercise 1
Read the sales_pipe.txt file into an R data frame as sales. 

```{r}

# Changing the file encoding in Notepad++ to UTF-8 BOM did not fix.
# Tried ANSI among other encodings did not fix.
# Replaced the broken | unsupported character with M.
# Continued with UTF-8-BOM Encoding as it was mentioned as a fix in class this week.
# class(sales) [1] "data.frame"

# Wouldn't Knit() without this
setwd("C:/Users/Micha/Desktop/Merrimack/R and Python Programming - Class 1/Module 2/")

sales_txt <- read.delim("Data/sales_pipe_encoding_UTF-8_BOM.txt"
                      ,stringsAsFactors=FALSE
                      ,encoding = "UTF-8-BOM"
                      ,sep ="|"
                      )

```

# Exercise 2
You can extract a vector of columns names from a data frame using the colnames() function. Notice the first column has some odd characters. Change the column name for the FIRST column in the sales date frame to Row.ID. 

**Note: You will need to assign the first element of colnames to a single character.**

```{r}
library(stringr)

# Assigned first element of colnames to a single character via the .txt file
# due to the inablity to load the file without
# Stores the column names as col_names.

col_names <- data.frame(colnames(sales_txt))

# Renames 1st element of the column name to "Row.ID"
colnames(sales_txt)[1] <- "Row.ID"

```

# Exercise 3
Convert both Order.ID and Order.Date to date vectors within the sales data frame. What is the number of days between the most recent order and the oldest order?
How many years is that?
How many weeks?

**Note: Use lubridate**

```{r}
library(lubridate)
library(stringr)

# Convert Order.ID into two columns Year and Order.ID | Used in Question 10
order_id_split <- str_split_fixed(sales_txt$Order.ID, pattern = "-", n = 3)

# Create new column called Year
sales_txt$Year <- as.integer(order_id_split[, 2])

# Combine the Order.ID back into one column
sales_txt$Order.ID <- paste(order_id_split[, 1], order_id_split[, 3], sep = "-")

# Change Order.Date vector to date format of YYYY-MM-DD
sales_txt$Order.Date <- mdy(sales_txt$Order.Date)

# Find the most recent order date
newest_order <- max(sales_txt$Order.Date)

# Find the oldest order date
oldest_order <- min(sales_txt$Order.Date)

# Difference of time between Newest and Oldest order dates
# I use difftime on next problem I just wanted to see if there was another way
time_between <- interval(oldest_order, newest_order)


# Assigns the interval between the oldest and newest
# Order dates for specific timeframe
days_between <- time_length(time_between, "days")
weeks_between <- time_length(time_between, "weeks")
years_between <- time_length(time_between, "years")

paste("Most Recent Order:", newest_order)
paste("Oldest Order:", oldest_order)
paste("Days Between Orders:", days_between)
paste("Weeks Between Order:", round(weeks_between, 2))
paste("Years Between Orders:", round(years_between, 2))

```

# Exercise 4
What is the average number of days it takes to ship an order?

```{r}
library(lubridate)

# Changes format from Ship.Date column from "Month_name DD YYYY" to "YYYY-MM-DD"
sales_txt$Ship.Date <- mdy(sales_txt$Ship.Date)

# Find the days between shipment for each column between Order.Date and Ship.Date
days_between_shipment <- difftime(sales_txt$Ship.Date, sales_txt$Order.Date, units = "days")

# Calculate the mean of the difference between the days_between_shipment
avg_ship_time_days <- mean(as.numeric(days_between_shipment))

paste(round(avg_ship_time_days, 2))

```

# Exercise 5
How many customers have the first name Bill?
You will need to split the customer name into first and last name segments and then use a regular expression to match the first name bill. Use the length() function to determine the number of customers with the first name Bill in the sales data. 

```{r}
library(stringr)

# Split the column Customer.Name into two columns separated by " "
customer_name_column_split <- str_split_fixed(sales_txt$Customer.Name, pattern=' ',n=2)

# Rename and replace the split columns into their repsective
# locations before split
colnames(sales_txt)[8:9] <- c("First.Name", "Last.Name")
sales_txt[,8] <- customer_name_column_split[, 1]
sales_txt[,9] <- customer_name_column_split[, 2]

# Find the number of "Bill"'s in First.Name
num_names_bill <- length(grep("Bill", sales_txt$First.Name))
paste("The number of Bill's in First.Name is:", num_names_bill)

```

# Exercise 6
How many mentions of the word 'table' are there in the Product.Name column? 
**Note you can do this in one line of code**

```{r}

num_name_table <- length(grep("table", sales_txt$Product.Name))
paste("The number of table's in Product.Name is:", num_name_table)

```

# Exercise 7
Create a table of counts for each state in the sales data. The counts table should be ordered alphabetically from A to Z. 

```{r}

# Create a table of counts for each state and sort by each state
state_levels <- factor(
    sales_txt$State,
    levels = sort(unique(sales_txt$State))
    )

# Create table for each state count
state_counts <- table(state_levels)

# Update the table to now sort alphabetically
sorted_state_counts <- state_counts[sort(names(state_counts))]

# Print the result
print(sorted_state_counts)


```

# Exercise 8
Create an alphabetically ordered barplot for each sales Category in the State of Texas. 

```{r}

# Create a subset for "Texas"
tx_sales <- subset(sales_txt, State == "Texas")

# Create a levels variable for the Category column
category_levels <- factor(
    tx_sales$Category,
    levels = sort(unique(tx_sales$Category))
)

# Create a table for each category count
category_counts <- table(category_levels)

# Sort the table alphabetically
sorted_category_counts <- category_counts[order(names(category_counts))]

# Create an alphabetically ordered barplot
# Faced issue where Y-axis was not going high enough
# Fixed with
barplot(
    sorted_category_counts,
    main = "Texas Sales by Category",
    xlab = "Category",
    ylab = "Sales"
    )

```

# Exercise 9
Find the average profit by region.
**Note: You will need to use the aggregate() function to do this. To understand how the function works type ?aggregate in the console.**

```{r}

# Calculate average profit by region
avg_profit_by_region <- aggregate(
    Profit ~ Region,
    data = sales_txt,
    FUN = mean
    )

print(avg_profit_by_region)

```

# Exercise 10
Find the average profit by order year. 
**Note: You will need to use the aggregate() function to do this. To understand how the function works type ?aggregate in the console.**

```{r}

# Calculate average profit by order year
avg_profit_by_year <- aggregate(
    Profit ~ Year,
    data = sales_txt,
    FUN = mean
    )

print(avg_profit_by_year)
```

